<?xml version="1.0" encoding="utf-8"?>

<project name="CoreRL"
	default="build">

	<property file="../libs/common.build.properties"/>
	<property name="OUTPUT_DIR"
		value="bin"/>
	<property name="SRC_DIR"
		value="src"/>
	<property name="ASSETS_DIR"
		value="assets"/>
	<property name="COMMON_LIBS"
		value="../libsRL"/>
	<property name="MOBILE_GRAPHICS"
		value="../roulette/assets/graphics_mobile.swc"/>
	<property name="BASE_DIR"
		value="${basedir}"/>

	<taskdef name="compc"
		classname="flex.ant.CompcTask"
		classpath="${FLEX_HOME}/ant/lib/flexTasks.jar"/>

	<target name="build">
		<echo message="building core..."/>
		<antcall target="compile"/>
	</target>

	<path id="src.files">
		<fileset dir="${SRC_DIR}">
			<include name="**/*.as"/>
		</fileset>
	</path>

	<target name="compile">
		<pathconvert property="src.classes"
			pathsep=" "
			dirsep="."
			refid="src.files">
			<map from="\"
				to="/"/>
			<map from="${BASE_DIR}/src/"
				to=""/>
			<mapper>
				<chainedmapper>
					<globmapper from="*.as"
						to="*"/>
				</chainedmapper>
			</mapper>
		</pathconvert>
		<echo message="${SRC_DIR}"/>
		<echo message="${src.classes}"/>
		<compc output="${OUTPUT_DIR}/CoreRL.swc"
			static-rsls="false"
			static-link-runtime-shared-libraries="true"
			include-classes="${src.classes}">
			<source-path path-element="${SRC_DIR}"/>
			<external-library-path file="${FLEX_HOME}/frameworks/libs/framework.swc"
				append="true"/>
			<external-library-path file="${FLEX_HOME}/frameworks/libs/air/airglobal.swc"
						append="true"/>
			<external-library-path file="${FLEX_HOME}/frameworks/libs/air/aircore.swc"
						append="true"/>
			<external-library-path file="${FLEX_HOME}/frameworks/libs/player/11.5/playerglobal.swc"
				append="true"/>
			<library-path file="${ASSETS_DIR}/core.swc"
				append="true"/>
			<library-path dir="${COMMON_LIBS}"
				includes="*.swc"
				append="true"/>
		</compc>
	</target>
</project>
